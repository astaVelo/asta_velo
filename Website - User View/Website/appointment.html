<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Radverleih AStA VELO</title>
    <meta name="description" content="Homepage des Fahrradverleihs AStA Velo.">

    <!-- import css stylesheets -->
    <link rel="stylesheet" href="CSS/Basics.css">
    <link rel="stylesheet" href="CSS/TopNav.css">
    <link rel="stylesheet" href="CSS/Formular.css">
    <!-- <link rel="stylesheet" href="CSS/Footer.css"> -->
    <link rel="stylesheet" href="CSS/grid.css">
    <link rel="stylesheet" href="CSS/Kalender.css">

    <!-- import font -->
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono|Roboto+Slab|Roboto:300,400,500,700"
        rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular.js"></script>


</head>

<body>

    <!-- Top Navigation -->
    <div class="topnav">
        <div id="logo">
                <img src="SVG/adminIcon.svg" alt="AStA VELO Logo" id="SVGLogo">
                <a href="home.html" id="home">
                <p id="LogoText">Radverleih AStA-VELO</p>
            </a>
        </div>

        <div id="social">
            <p id="email">Tel.: +49 681 - 302 2900 | velo@asta.uni-saarland.de</p>
            <a target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/AStA.UdS"><img
                    id="first-top-logo" class="topnav-social-logos" src="SVG/facebook-logo.svg" alt="Facebook"
                    id="FacebookLogo"></a>
            <a target="_blank" rel="noopener noreferrer" href="https://www.twitter.com/AStA_UdS"><img
                    class="topnav-social-logos" src="SVG/twitter.svg" alt="Twitter" id="TwitterLogo"></a>
            <a target="_blank" rel="noopener noreferrer" href="https://www.instagram.com/asta_uds/"><img
                    class="topnav-social-logos" src="SVG/instagram.svg" alt="Instagram" id="InstagramLogo"></a>
        </div>
    </div>




    <!--Main Content-->
    <div class="mainsite" ng-App="myApp" ng-controller="appointmentCtrl">
        <div class="outercontainer">
            <div class="container" id="appointment_container">
                <div class="form">
                    <h2>AStA Velo Terminvereinbarung</h2>
                    <h4>Wähl einen Termin aus, an dem du dir gerne ein Fahrrad anschauen kommen
                        möchtest:<br>
                        Choose a date where you would like to come and see a bike:</h4>
                    <form>
                        <p class="FormHeading">Vorname/Firstname</p>
                        <input type="text" id="vorname" ng-model="vorname" placeholder="Vorname" required>
                        <p class="FormHeading">Nachname/Lastname</p>
                        <input type="text" id="nachname" ng-model="nachname" placeholder="Nachname" required>
                        <p class="FormHeading">Telefonnummer/Phone number</p>
                        <input type="text" id="nummer" ng-model="nummer" placeholder="Nummer" required>
                        <p class="FormHeading">E-Mail Adresse/Email address</p>
                        <input type="text" id="e-mail" ng-model="email" placeholder="E-Mail" required>
                        <p class="FormHeading">Datum/Date</p>
                        <input type="text" id="" ng-model="datum" value="29.11.2019" name="rentdate" id="today"
                            placeholder="DD.MM.YYYY" required>
                        <input type="text" id="time" ng-model="zeit" value="29.11.2019" name="rentdate" id="today"
                            placeholder="HH:MM" required>
                            <p>Bitte achte auf unsere Öffnungszeiten!<br>
                            Please pay attention to the opening hours!</p><br>
<!--                         <div id="anmerkungen">
                            <p class="FormHeading" id="specialhint">Hier kannst du uns schon mal Fahrräder nennen, die
                                dir gefallen:</p>
                            <textarea name="anmerkungen" id="largeInput" ng-model="anmerkungen"
                                placeholder="Anmerkungen..."></textarea>
                        </div> -->
<!--                         <p class="FormHeading">Ich möchte mich für den Newsletter anmelden</p>
                        <input type="checkbox" id="newsletter_checkbox" name="newsletter" ng-model="newsletter" /> -->

                        <p>Ich möchte mich für den Newsletter anmelden/I would like to register for the newsletter
                        <input type="checkbox" id="newsletter_checkbox" name="newsletter" ng-model="newsletter" /></p>

                        <button type="submit" id="requestAppointmentButton">Fertig</button>
                    </form>
                </div>
            </div>


            <div class="container" id="danke_container" style="display:none">
                <div class="form" style="min-height: 300px">
                    <div style="height:300px; width:300px; text-align:center; position:absolute; left:35%; top:4%;">
                        <span class="danke"
                            style="color: #76C659; display: inline-block; font-size: 120px; vertical-align: center; border-color: #76C659;">&#10003;</span>
                        <h1>Vielen Dank für deine Anfrage!</h1>
                        <h2>Thank you for your inquiry</h2>
                    </div>
                </div>
            </div>

        </div>
    </div>



</body>

<script type="text/javascript">


    var app = angular.module('myApp', []);
    app.controller('appointmentCtrl', function ($scope, $http) {



        var button = document.getElementById('requestAppointmentButton')

        button.onclick = function () {
            if ($scope.vorname == null || $scope.nachname == null || $scope.nummer == null || $scope.email == null || $scope.datum == null || $scope.zeit == null) {
                alert("Bitte geben Sie die Daten für eine Terminvereinbarung ein!")
                console.log($scope.datum + " " + $scope.zeit)


            } else {
                //console.log($scope.vorname + $scope.nachname + $scope.email + $scope.datum + $scope.anmerkungen + $scope.type)
                /*var json_data = JSON.stringify({
                    id: 0, date_time: $scope.datum, email: $scope.email, confirmed: false,
                    first_name: $scope.vorname, last_name: $scope.nachname, phone_number: $scope.nummer, deposit: 0, number_of_bikes: 0, type: "pickup", reservation_id: 0
                })*/

                // check if the email is valid
                var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

                var valide_email = re.test($scope.email);

                //check if date is valid
                const dataRe = /^[0-9]{2}\.[0-1][0-9]\.[1-2][0-9]{3}$/;
                var valides_datum = dataRe.test($scope.datum);

                var short_months = ["02","04","06","09","11"]

                //format dd.mm.yyyy
                if (valides_datum){
                    parts = $scope.datum.split(".")
                    //before 1920 or after 2020
                    if ((parseInt(parts[2]) > 2020) || (parseInt(parts[2]) < 1920)){
                        valides_datum = false;
                    }
                    //day <1 or >31
                    else if ((parseInt(parts[0]) < 1) || (parseInt(parts[0]) > 31)){
                        valides_datum = false;
                    }
                    //month <1 or >12
                    else if ((parseInt(parts[1]) < 1) || (parseInt(parts[1]) > 12)){
                        valides_datum = false;
                    }
                    //31st day on a 30-day month
                    else if ((short_months.includes(parts[1])) && (parts[0] == "31")){
                        valides_datum = false;
                    }
                }

                // check if the time is valid
                const zeitRe = /^[0-2][0-9]\:[0-5][0-9]$/;

                var valide_zeit = zeitRe.test($scope.zeit);

                if (valide_zeit){
                    parts = $scope.zeit.split(":")

                    if ((parseInt(parts[0])>23) || (parseInt(parts[1])>59)){
                        valide_zeit = false;
                    }
                }



                if (!valide_email){
                    alert("Bitte geben Sie eine gültige Mailadresse an!")
                }
                else if (!valides_datum){
                    alert("Bitte geben Sie eine gültiges Datum an!")
                }
                else if (!valide_zeit){
                    alert("Bitte geben Sie eine gültige Zeit an!")
                }
                // if everything is valid
                else {
                    document.getElementById('appointment_container').style.display = 'none'
                    document.getElementById('danke_container').style.display = 'block'
                    $scope.date_time = $scope.datum + "." + $scope.zeit


                    console.log($scope.datum)
                    var json_data = JSON.stringify({
                        id: 0, date_time: $scope.date_time, confirmed: false, type: 'pickup', reservation_id: 0, loan_id: 0,
                        start_date: '01.01.10.01:01', end_date: '01.01.10.01:01', loan_duration: 0, price: 0, status: 'string', email: $scope.email, bike_ids: '',
                        first_name: $scope.vorname, last_name: $scope.nachname, phone_number: $scope.nummer, deposit: 0, number_of_bikes: 0, birthday: '', street: '', location: ''
                    })
                    console.log(json_data)

                    var config = {
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Access-Control-Allow-Origin': '*'
                        }
                    }

                    $http.post("http://127.0.0.1:5000/actions/api/v1/sendAppointmentRequest", json_data, config)
                    .then(function (response) {
                        $scope.reservation_response = response.data
                        console.log(response.data)
                    })

                    setTimeout(function(){if (newsletter_checkbox.checked == true) {
                        console.log("newsletter is checked")
                        //send Newsletter Request
                        var json_newsletter = JSON.stringify({
                            id: 0, email: $scope.email
                    })



                    $http.post("http://127.0.0.1:5000/actions/api/v1/sendNewsletterRequest", json_newsletter, config).then(function(response){
        
                    })
                }}, 200);

                }


            }


        }
    });

</script>

</html>